"use strict";var css=require("css"),CleanCSS=require("clean-css"),matchMedia=require("./matchMedia"),splitByMediaQuery=function(a){var b=a.cssFile,c=a.mediaOptions,d=a.minify,e=a.units,f={},g=css.parse(b).stylesheet.rules,h={common:[],desktop:[],mobile:[],tabletPortrait:[],tabletLandscape:[],tablet:[]};return g.forEach(function(a,b){var d=a.type,f=a.media,i=matchMedia({mediaQuery:f,mediaOptions:c,units:e}),j=i.isDesktop,k=i.isTablet,l=i.isTabletLandscape,m=i.isTabletPortrait,n=i.isMobile,o=g[b];"media"===d?(j&&h.desktop.push(o),l&&(h.tablet.push(o),h.tabletLandscape.push(o)),m&&(h.tablet.push(o),h.tabletPortrait.push(o)),n&&h.mobile.push(o),!j&&!k&&!n&&h.common.push(o)):h.common.push(o)}),Object.keys(h).forEach(function(a){f[a]=[];var b=h[a];b.forEach(function(b){var c=b.media,d=b.rules,e=f[a].map(function(a){var b=a.media;return b}).indexOf(c);!c||0>e?f[a].push(b):f[a][e].rules=f[a][e].rules.concat(d)});var c=css.stringify({type:"stylesheet",stylesheet:{rules:f[a]}});f[a]=d?new CleanCSS().minify(c).styles:c}),f};module.exports=splitByMediaQuery;